# 字符编码

在计算机中, 所有的数据都是以二进制形式存在的. 字符 `char` 也不例外; 为了表示字符, 我们需要建立一套机制**字符表**, 规定每个字符和二进制数之间的一一对应关系。有了字符集之后，计算机就可以通过查表完成二进制数到字符的转换。

## ASCLL 字符集

[ASCLL 码] 是最早出现的字符集, 使用 7 位二进制数, 最多能够表示 128 个字符, 包括英文字母的大小写, 数字 0- 9, 一些标点符号, 以及一些控制字符

![ASCLL](https://www.hello-algo.com/chapter_data_structure/character_encoding.assets/ascii_table.png)

==但是 ASCLL 仅仅只能表示**英语**==

## utf-8 编码

目前, UTF-8 已经成为国际上使用最为广泛的 Unicode 编码方法, 是一种可变长的编码, 是用一个到四个字节来进行编码, 根据字符的复杂性而变, ASCII 字符只需要 1 个字节，拉丁字母和希腊字母需要 2 个字节，常用的中文字符需要 3 个字节，其他的一些生僻字符需要 4 个字节。

UTF-8 具有两种情况:

- 对于长度为 1 的字符, 将最高位设置为 $0$, 其余 7 位设置为 Unicode 码点. 但是 ==ASCII 字符在 Unicode 字符集中占据了前 128 个码点==.
- 对于长度为 n de 字符(其中 $n > 1$), 将首个字节最高 n 位都设置为 1, 第 n + 1 位设置为 0; 从第二个字节开始, 将每个字节的高 2 位都设置为 10; 其余所有位与填充字符的 Unicode 码点.

以 "Hello 算法" 为例:

![UTF-8 编码示例](https://www.hello-algo.com/chapter_data_structure/character_encoding.assets/utf-8_hello_algo.png)

从存储空间的角度看，使用 UTF-8 表示英文字符非常高效，因为它仅需 1 个字节；使用 UTF-16 编码某些非英文字符（例如中文）会更加高效，因为它只需要 2 个字节，而 UTF-8 可能需要 3 个字节。从兼容性的角度看，UTF-8 的通用性最佳，许多工具和库都优先支持 UTF-8 。

## 编程语言的字符编码

对于以往的大多数编程语言，程序运行中的字符串都采用 UTF-16 或 UTF-32 这类等长的编码。这是因为在等长编码下，我们可以将字符串看作数组来处理，具体来说：

- **随机访问**: UTF-16 编码的字符串可以很容易的进行随机访问
- **字符计数**: 计算 UTF-16 字符串的长度时间复杂度也是 $O(1)$. 但是, 计算 UTF-8 编码的字符串的长度需要遍历整个字符串
- **字符串操作**: 在 UTF-16 编码字符串中, 很多字符串操作（如分割、连接、插入、删除等）都更容易进行。在 UTF-8 编码的字符串上进行这些操作通常需要额外的计算，以确保不会产生无效的 UTF-8 编码。

### 以 C++ 为例

```cpp
#include <iostream>
#include <string>

int main() {
        std::string s = "Hello";
        std::cout << "Size of string object: " << sizeof(s) << std::endl;
    }
```

输出

```shell
Size of string object: 24
```

为什么会出现这种情况, 这是因为 string 类型占用的字节数取决于具体实现，通常是 24 或者 32 字节，其中包括**指向字符串的指针**、**字符串长度**以及其他一些**元数据**。在这个程序中，我们定义了一个 string 对象 s，并使用 sizeof 运算符来获取它占用的字节数。由于这个程序的具体实现中，string 类型占用 24 个字节，因此程序输出的结果是 Size of string object: 24

> char 类型的长度是 1 bytes 吗？

```
这个与编程语言采用的编码方法有关。例如，Java, JS, TS, C# 都采用 UTF-16 编码（保存 Unicode 码点），因此 char 类型的长度为 2 bytes 。
```

## 不同语言提出不同的编码方案

- Python 3 使用一种灵活的字符串表示，存储的字符长度取决于字符串中最大的 Unicode 码点。对于全部是 ASCII 字符的字符串，每个字符占用 1 个字节；如果字符串中包含的字符超出了 ASCII 范围，但全部在基本多语言平面（BMP）内，每个字符占用 2 个字节；如果字符串中有超出 BMP 的字符，那么每个字符占用 4 个字节。
- Go 语言的 string 类型在内部使用 UTF-8 编码。Go 语言还提供了 rune 类型，它用于表示单个 Unicode 码点。
- Rust 语言的 str 和 String 类型在内部使用 UTF-8 编码。Rust 也提供了 char 类型，用于表示单个 Unicode 码点。

需要注意的是，以上讨论的都是字符串在编程语言中的存储方式，这和 ==字符串如何在文件中存储或在网络中传输是两个不同的问题==
